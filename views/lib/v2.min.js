var client=new WebTorrent;client.on("error",function(e){console.error("ERROR: "+e.message)});var torrentId="{{ w.magnet.sd | safe }}";const player=new Plyr("#player",{debug:!1,hideControls:!0,quality:[1080,720,576,480,360,240],settings:["captions","quality","speed","loop"]});function onTorrent(e){log("Got torrent metadata!"),log("Torrent info hash: "+e.infoHash+' <a href="'+e.magnetURI+'" target="_blank">[Magnet URI]</a> <a href="'+e.torrentFileBlobURL+'" target="_blank" download="'+e.name+'.torrent">[Download .torrent]</a>');var o=e.files.find(function(e){return e.name.endsWith(".mp4")});console.log("Adicionei o WebSeed. Peers:"+e.numPeers),e.addWebSeed("{{w.webseed.sd}}"),o.renderTo("video",{autoplay:!0,muted:!0},function(){log("ready to play!"),document.getElementById("player").style.height="100vh",setTimeout(function(){player.play()},2e3)});setInterval(function(){log("Progress: "+(100*e.progress).toFixed(1)+"%"),0==e.downloadSpeed&&(console.log("Adicionei o WebSeed. Peers:"+e.numPeers),e.addWebSeed("{{w.webseed.sd}}"))},1e3);var n=!0,t=!1,d=!0;e.on("download",function(o){console.log("download speed: "+e.downloadSpeed),100*e.progress>5&&d&&(console.log("Removi o WebSeed. Peers:"+e.numPeers),e.removePeer("{{w.webseed.sd}}"),n=!0,t=!1,d=!1),e.downloadSpeed<2e5&&n&&(console.log("Adicionei o WebSeed. Peers:"+e.numPeers),e.addWebSeed("{{w.webseed.sd}}"),n=!1,t=!0),e.downloadSpeed>=5e5&&t&&(console.log("Removi o WebSeed. Peers:"+e.numPeers),e.removePeer("{{w.webseed.sd}}"),n=!0,t=!1)})}function log(e){console.log(e)}document.getElementById("player").style.height="100vh",client.add(torrentId,onTorrent),player.on("play",e=>{setTimeout(function(){document.getElementById("exit-button").style.opacity="0"},2e3)}),player.on("controlsshown",e=>{document.getElementById("exit-button").style.opacity="0.9"}),player.on("pause",e=>{document.getElementById("exit-button").style.opacity="0.9"});
